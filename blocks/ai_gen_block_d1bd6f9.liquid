{% doc %}
  @prompt
    Create a minimal, horizontally swipeable category filter bar for a fashion e-commerce website. Use a clean light gray background (#F5F5F5) with a row of rectangular buttons labeled in uppercase sans-serif text (e.g., ALL, NEW, FORMAL, PRINTS, PLAIN, etc.). Each button has a thin black border and white fill, except the active one ('ALL'), which features a solid black background with white text.
    
    The filter bar should scroll horizontally (swipeable) on mobile and have smooth snap scrolling. Maintain equal spacing, rounded corners (small radius), and consistent padding. Add a subtle hover or active state transition that inverts colors. The style should feel premium, minimal, and fashion-forward, emphasizing clarity and usability., should be option for adding 20 Category and also in desktop version there should be option for alligment, only ALL should have black background and white text. all og the other should redirect to saved category when a user click it
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% comment %} Get current collection information - multiple ways to ensure we catch it {% endcomment %}
{% assign current_collection_handle = collection.handle | default: '' %}
{% assign current_collection_id = collection.id | default: '' %}
{% assign current_collection_title = collection.title | default: '' %}
{% assign current_url = request.path %}

{% comment %} Extract collection handle from URL as backup {% endcomment %}
{% assign url_parts = current_url | split: '/' %}
{% assign url_collection_handle = '' %}
{% assign found_collections = false %}
{% for part in url_parts %}
  {% if found_collections %}
    {% assign url_collection_handle = part %}
    {% break %}
  {% endif %}
  {% if part == 'collections' %}
    {% assign found_collections = true %}
  {% endif %}
{% endfor %}

{% style %}
  .ai-category-filter-{{ ai_gen_id }} {
    width: 100%;
    background-color: #F5F5F5;
    padding: {{ block.settings.vertical_padding }}px 0;
  }

  .ai-category-filter-container-{{ ai_gen_id }} {
    width: 100%;
    overflow-x: auto;
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
  }

  .ai-category-filter-container-{{ ai_gen_id }}::-webkit-scrollbar {
    display: none;
  }

  .ai-category-filter-list-{{ ai_gen_id }} {
    display: flex;
    gap: {{ block.settings.button_spacing }}px;
    padding: 0 {{ block.settings.horizontal_padding }}px;
    margin: 0;
    list-style: none;
    min-width: min-content;
  }

  .ai-category-filter-item-{{ ai_gen_id }} {
    flex-shrink: 0;
    scroll-snap-align: start;
  }

  .ai-category-filter-button-{{ ai_gen_id }} {
    display: inline-block;
    padding: {{ block.settings.button_padding_vertical }}px {{ block.settings.button_padding_horizontal }}px;
    background-color: {{ block.settings.button_bg_color }};
    color: {{ block.settings.button_text_color }};
    border: {{ block.settings.border_width }}px solid {{ block.settings.button_border_color }};
    border-radius: {{ block.settings.border_radius }}px;
    font-family: {{ block.settings.button_font.family }}, {{ block.settings.button_font.fallback_families }};
    font-weight: {{ block.settings.button_font.weight }};
    font-size: {{ block.settings.button_font_size }}px;
    text-transform: capitalize;;
    letter-spacing: {{ block.settings.letter_spacing }}px;
    text-decoration: none;
    cursor: pointer;
    transition: all {{ block.settings.transition_speed }}s ease;
    white-space: nowrap;
  }

  .ai-category-filter-button-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.button_hover_bg_color }};
    color: {{ block.settings.button_hover_text_color }};
    border-color: {{ block.settings.button_hover_border_color }};
  }

  .ai-category-filter-button-{{ ai_gen_id }}.active {
    background-color: {{ block.settings.active_bg_color }} !important;
    color: {{ block.settings.active_text_color }} !important;
    border-color: {{ block.settings.active_border_color }} !important;
  }

  .debug-info-{{ ai_gen_id }} {
    padding: 15px;
    background: #f8f8f8;
    border: 1px solid #ddd;
    margin: 10px 20px;
    font-family: monospace;
    font-size: 12px;
    line-height: 1.6;
  }

  .debug-info-{{ ai_gen_id }} strong {
    color: #333;
  }

  @media screen and (min-width: 750px) {
    .ai-category-filter-container-{{ ai_gen_id }} {
      {% if block.settings.desktop_scrollable %}
        overflow-x: auto;
      {% else %}
        overflow-x: visible;
      {% endif %}
    }

    .ai-category-filter-list-{{ ai_gen_id }} {
      {% if block.settings.desktop_alignment == 'left' %}
        justify-content: flex-start;
      {% elsif block.settings.desktop_alignment == 'center' %}
        justify-content: center;
      {% elsif block.settings.desktop_alignment == 'right' %}
        justify-content: flex-end;
      {% elsif block.settings.desktop_alignment == 'space-between' %}
        justify-content: space-between;
      {% endif %}
      
      {% unless block.settings.desktop_scrollable %}
        flex-wrap: wrap;
      {% endunless %}
    }
  }
{% endstyle %}

<div class="ai-category-filter-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-category-filter-container-{{ ai_gen_id }}">
    <ul class="ai-category-filter-list-{{ ai_gen_id }}">
      {% assign found_active = false %}
      {% assign active_category_index = 0 %}
      
      {% comment %} First pass: Find exact matches only {% endcomment %}
      {% for i in (1..20) %}
        {% liquid
          assign category_enabled_key = 'category_' | append: i | append: '_enabled'
          assign category_label_key = 'category_' | append: i | append: '_label'
          assign category_collection_key = 'category_' | append: i | append: '_collection'

          assign category_enabled = block.settings[category_enabled_key]
          assign category_label = block.settings[category_label_key]
          assign category_collection = block.settings[category_collection_key]
          
          # Determine if this category is active - EXACT MATCHES ONLY
          assign is_active = false
          assign match_reason = ''
          
          if category_collection != blank
            # Try multiple ways to match the collection - EXACT MATCHES ONLY
            assign cat_handle = category_collection.handle
            assign cat_id = category_collection.id | plus: 0
            assign current_id = current_collection_id | plus: 0
            
            # Method 1: Direct handle comparison (EXACT)
            if cat_handle == current_collection_handle and current_collection_handle != ''
              assign is_active = true
              assign match_reason = 'exact handle match'
              assign found_active = true
              assign active_category_index = i
            # Method 2: URL handle comparison (EXACT)
            elsif cat_handle == url_collection_handle and url_collection_handle != ''
              assign is_active = true
              assign match_reason = 'exact url handle match'
              assign found_active = true
              assign active_category_index = i
            # Method 3: ID comparison (EXACT)
            elsif cat_id == current_id and cat_id != 0
              assign is_active = true
              assign match_reason = 'exact id match'
              assign found_active = true
              assign active_category_index = i
            endif
          else
            # Handle the ALL category (no collection assigned)
            if i == 1
              if url_collection_handle == 'all' or current_collection_handle == 'all'
                assign is_active = true
                assign match_reason = 'all collection'
                assign found_active = true
                assign active_category_index = i
              elsif current_collection_handle == blank and url_collection_handle == blank
                # No collection page, make first item active
                assign is_active = true
                assign match_reason = 'default first'
                assign found_active = true
                assign active_category_index = i
              endif
            endif
          endif
        %}

        {% if category_enabled and category_label != blank %}
          <li class="ai-category-filter-item-{{ ai_gen_id }}">
            
              href="{% if category_collection != blank %}{{ category_collection.url }}{% else %}/collections/all{% endif %}"
              class="ai-category-filter-button-{{ ai_gen_id }}{% if is_active %} active{% endif %}"
              data-collection-id="{% if category_collection != blank %}{{ category_collection.id }}{% else %}all{% endif %}"
              data-collection-handle="{% if category_collection != blank %}{{ category_collection.handle }}{% else %}all{% endif %}"
              data-category-index="{{ i }}"
              data-match-reason="{{ match_reason }}"
            >
              {{ category_label }}
            </a>
          </li>
        {% endif %}
      {% endfor %}
    </ul>
  </div>
  
  {% if block.settings.show_debug %}
    <div class="debug-info-{{ ai_gen_id }}">
      <strong>Debug Information:</strong><br>
      Current Collection Handle: <strong>{{ current_collection_handle | default: 'none' }}</strong><br>
      Current Collection ID: <strong>{{ current_collection_id | default: 'none' }}</strong><br>
      Current Collection Title: <strong>{{ current_collection_title | default: 'none' }}</strong><br>
      URL Collection Handle: <strong>{{ url_collection_handle | default: 'none' }}</strong><br>
      Current URL: <strong>{{ current_url }}</strong><br>
      Found Active: <strong>{{ found_active }}</strong><br>
      Active Category Index: <strong>{{ active_category_index }}</strong><br>
      <br>
      <strong>All Configured Categories:</strong><br>
      {% for i in (1..20) %}
        {% liquid
          assign category_enabled_key = 'category_' | append: i | append: '_enabled'
          assign category_label_key = 'category_' | append: i | append: '_label'
          assign category_collection_key = 'category_' | append: i | append: '_collection'
          
          assign cat_enabled = block.settings[category_enabled_key]
          assign cat_label = block.settings[category_label_key]
          assign cat_collection = block.settings[category_collection_key]
        %}
        {% if cat_enabled and cat_label != blank %}
          Category {{ i }}: <strong>{{ cat_label }}</strong> â†’ 
          {% if cat_collection != blank %}
            Collection: {{ cat_collection.title }} (handle: {{ cat_collection.handle }}, id: {{ cat_collection.id }})
          {% else %}
            No collection assigned
          {% endif %}
          <br>
        {% endif %}
      {% endfor %}
    </div>
  {% endif %}
</div>

{% schema %}
{
  "name": "Category filter bar",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "vertical_padding",
      "min": 0,
      "max": 50,
      "step": 5,
      "unit": "px",
      "label": "Vertical padding",
      "default": 20
    },
    {
      "type": "range",
      "id": "horizontal_padding",
      "min": 0,
      "max": 50,
      "step": 5,
      "unit": "px",
      "label": "Horizontal padding",
      "default": 20
    },
    {
      "type": "range",
      "id": "button_spacing",
      "min": 5,
      "max": 30,
      "step": 5,
      "unit": "px",
      "label": "Button spacing",
      "default": 10
    },
    {
      "type": "header",
      "content": "Desktop settings"
    },
    {
      "type": "select",
      "id": "desktop_alignment",
      "label": "Alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        },
        {
          "value": "space-between",
          "label": "Space between"
        }
      ],
      "default": "center"
    },
    {
      "type": "checkbox",
      "id": "desktop_scrollable",
      "label": "Enable horizontal scroll on desktop",
      "default": false
    },
    {
      "type": "header",
      "content": "Button style"
    },
    {
      "type": "font_picker",
      "id": "button_font",
      "label": "Font",
      "default": "sans-serif"
    },
    {
      "type": "range",
      "id": "button_font_size",
      "min": 10,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Font size",
      "default": 12
    },
    {
      "type": "range",
      "id": "letter_spacing",
      "min": 0,
      "max": 3,
      "step": 0.5,
      "unit": "px",
      "label": "Letter spacing",
      "default": 1
    },
    {
      "type": "range",
      "id": "button_padding_vertical",
      "min": 5,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Vertical padding",
      "default": 10
    },
    {
      "type": "range",
      "id": "button_padding_horizontal",
      "min": 10,
      "max": 40,
      "step": 5,
      "unit": "px",
      "label": "Horizontal padding",
      "default": 20
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Border radius",
      "default": 4
    },
    {
      "type": "range",
      "id": "border_width",
      "min": 1,
      "max": 3,
      "step": 1,
      "unit": "px",
      "label": "Border width",
      "default": 1
    },
    {
      "type": "range",
      "id": "transition_speed",
      "min": 0,
      "max": 1,
      "step": 0.1,
      "label": "Transition speed",
      "default": 0.3
    },
    {
      "type": "header",
      "content": "Default button colors"
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_border_color",
      "label": "Border",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Hover state"
    },
    {
      "type": "color",
      "id": "button_hover_bg_color",
      "label": "Background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_hover_text_color",
      "label": "Text",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_hover_border_color",
      "label": "Border",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Active state"
    },
    {
      "type": "color",
      "id": "active_bg_color",
      "label": "Background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "active_text_color",
      "label": "Text",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "active_border_color",
      "label": "Border",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Debug"
    },
    {
      "type": "checkbox",
      "id": "show_debug",
      "label": "Show debug info",
      "default": false,
      "info": "Enable to troubleshoot active state issues"
    },
    {
      "type": "header",
      "content": "Category 1"
    },
    {
      "type": "checkbox",
      "id": "category_1_enabled",
      "label": "Enable",
      "default": true
    },
    {
      "type": "text",
      "id": "category_1_label",
      "label": "Label",
      "default": "ALL"
    },
    {
      "type": "collection",
      "id": "category_1_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 2"
    },
    {
      "type": "checkbox",
      "id": "category_2_enabled",
      "label": "Enable",
      "default": true
    },
    {
      "type": "text",
      "id": "category_2_label",
      "label": "Label",
      "default": "NEW"
    },
    {
      "type": "collection",
      "id": "category_2_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 3"
    },
    {
      "type": "checkbox",
      "id": "category_3_enabled",
      "label": "Enable",
      "default": true
    },
    {
      "type": "text",
      "id": "category_3_label",
      "label": "Label",
      "default": "FORMAL"
    },
    {
      "type": "collection",
      "id": "category_3_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 4"
    },
    {
      "type": "checkbox",
      "id": "category_4_enabled",
      "label": "Enable",
      "default": true
    },
    {
      "type": "text",
      "id": "category_4_label",
      "label": "Label",
      "default": "PRINTS"
    },
    {
      "type": "collection",
      "id": "category_4_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 5"
    },
    {
      "type": "checkbox",
      "id": "category_5_enabled",
      "label": "Enable",
      "default": true
    },
    {
      "type": "text",
      "id": "category_5_label",
      "label": "Label",
      "default": "PLAIN"
    },
    {
      "type": "collection",
      "id": "category_5_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 6"
    },
    {
      "type": "checkbox",
      "id": "category_6_enabled",
      "label": "Enable",
      "default": false
    },
    {
      "type": "text",
      "id": "category_6_label",
      "label": "Label"
    },
    {
      "type": "collection",
      "id": "category_6_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 7"
    },
    {
      "type": "checkbox",
      "id": "category_7_enabled",
      "label": "Enable",
      "default": false
    },
    {
      "type": "text",
      "id": "category_7_label",
      "label": "Label"
    },
    {
      "type": "collection",
      "id": "category_7_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 8"
    },
    {
      "type": "checkbox",
      "id": "category_8_enabled",
      "label": "Enable",
      "default": false
    },
    {
      "type": "text",
      "id": "category_8_label",
      "label": "Label"
    },
    {
      "type": "collection",
      "id": "category_8_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 9"
    },
    {
      "type": "checkbox",
      "id": "category_9_enabled",
      "label": "Enable",
      "default": false
    },
    {
      "type": "text",
      "id": "category_9_label",
      "label": "Label"
    },
    {
      "type": "collection",
      "id": "category_9_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 10"
    },
    {
      "type": "checkbox",
      "id": "category_10_enabled",
      "label": "Enable",
      "default": false
    },
    {
      "type": "text",
      "id": "category_10_label",
      "label": "Label"
    },
    {
      "type": "collection",
      "id": "category_10_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 11"
    },
    {
      "type": "checkbox",
      "id": "category_11_enabled",
      "label": "Enable",
      "default": false
    },
    {
      "type": "text",
      "id": "category_11_label",
      "label": "Label"
    },
    {
      "type": "collection",
      "id": "category_11_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 12"
    },
    {
      "type": "checkbox",
      "id": "category_12_enabled",
      "label": "Enable",
      "default": false
    },
    {
      "type": "text",
      "id": "category_12_label",
      "label": "Label"
    },
    {
      "type": "collection",
      "id": "category_12_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 13"
    },
    {
      "type": "checkbox",
      "id": "category_13_enabled",
      "label": "Enable",
      "default": false
    },
    {
      "type": "text",
      "id": "category_13_label",
      "label": "Label"
    },
    {
      "type": "collection",
      "id": "category_13_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 14"
    },
    {
      "type": "checkbox",
      "id": "category_14_enabled",
      "label": "Enable",
      "default": false
    },
    {
      "type": "text",
      "id": "category_14_label",
      "label": "Label"
    },
    {
      "type": "collection",
      "id": "category_14_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 15"
    },
    {
      "type": "checkbox",
      "id": "category_15_enabled",
      "label": "Enable",
      "default": false
    },
    {
      "type": "text",
      "id": "category_15_label",
      "label": "Label"
    },
    {
      "type": "collection",
      "id": "category_15_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 16"
    },
    {
      "type": "checkbox",
      "id": "category_16_enabled",
      "label": "Enable",
      "default": false
    },
    {
      "type": "text",
      "id": "category_16_label",
      "label": "Label"
    },
    {
      "type": "collection",
      "id": "category_16_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 17"
    },
    {
      "type": "checkbox",
      "id": "category_17_enabled",
      "label": "Enable",
      "default": false
    },
    {
      "type": "text",
      "id": "category_17_label",
      "label": "Label"
    },
    {
      "type": "collection",
      "id": "category_17_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 18"
    },
    {
      "type": "checkbox",
      "id": "category_18_enabled",
      "label": "Enable",
      "default": false
    },
    {
      "type": "text",
      "id": "category_18_label",
      "label": "Label"
    },
    {
      "type": "collection",
      "id": "category_18_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 19"
    },
    {
      "type": "checkbox",
      "id": "category_19_enabled",
      "label": "Enable",
      "default": false
    },
    {
      "type": "text",
      "id": "category_19_label",
      "label": "Label"
    },
    {
      "type": "collection",
      "id": "category_19_collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Category 20"
    },
    {
      "type": "checkbox",
      "id": "category_20_enabled",
      "label": "Enable",
      "default": false
    },
    {
      "type": "text",
      "id": "category_20_label",
      "label": "Label"
    },
    {
      "type": "collection",
      "id": "category_20_collection",
      "label": "Collection"
    }
  ],
  "presets": [
    {
      "name": "Category filter bar"
    }
  ]
}
{% endschema %}